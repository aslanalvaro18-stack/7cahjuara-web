<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>7C Portal — HTML (tanpa Admin)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#4f46e5;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#071024 0%, #031021 100%);color:#e6eef8}
    .wrap{min-height:100vh;display:flex;flex-direction:column}
    header{padding:18px 20px;display:flex;align-items:center;gap:16px}
    .logo{font-weight:700;font-size:18px;letter-spacing:0.4px}
    nav{margin-left:auto;display:flex;gap:10px;align-items:center}
    .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer}
    main{flex:1;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media (max-width:900px){main{grid-template-columns:1fr;padding:12px}}

    /* Card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 6px 24px rgba(2,6,23,0.6)}

    /* Math game */
    .game h2{margin:0 0 6px 0}
    .problem{font-size:28px;font-weight:700;margin:12px 0}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    input[type=number]{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;width:120px}
    .row{display:flex;gap:8px;align-items:center}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}

    /* Leaderboard */
    .leaderboard{max-height:360px;overflow:auto}
    .lb-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.01)}

    /* Footer */
    footer{padding:12px;text-align:center;color:var(--muted);font-size:13px}

    /* Interactive background canvas sits behind everything */
    #bgCanvas{position:fixed;left:0;top:0;width:100%;height:100%;z-index:0;pointer-events:none}
    .foreground{position:relative;z-index:1}

    /* small helpers */
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px}
    .pill{padding:6px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.04)}
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>
  <div class="wrap">
    <header class="foreground">
      <div class="logo">7C Portal</div>
      <nav>
        <a class="btn" href="#">Home</a>
        <a class="btn" href="#">Article</a>
        <a class="btn" href="#">Gallery</a>
        <a class="btn" href="#">About</a>
        <a class="btn" href="#">Contact</a>
        <button class="btn" id="btnRefreshAll">Refresh Semua</button>
      </nav>
    </header>

    <main class="foreground">
      <!-- Left: konten utama / permainan matematika -->
      <section class="card game">
        <h2>Game Math — Latihan Cepat</h2>
        <p class="muted">Kerjakan soal secepat mungkin. Skor tersimpan di leaderboard lokal (LocalStorage).</p>

        <div class="controls">
          <label class="small">Mode:
            <select id="modeSelect" class="pill">
              <option value="add">Tambah</option>
              <option value="sub">Kurang</option>
              <option value="mul">Kali</option>
              <option value="div">Bagi</option>
            </select>
          </label>

          <label class="small">Kesulitan:
            <select id="difficulty" class="pill">
              <option value="1">Mudah</option>
              <option value="2">Sedang</option>
              <option value="3">Sulit</option>
            </select>
          </label>

          <label class="small">Jumlah Soal:
            <input id="totalQ" type="number" value="10" min="1" max="100" style="width:84px"/>
          </label>

          <button class="btn" id="btnStart">MULAI</button>
          <button class="btn" id="btnRestart">Restart</button>
        </div>

        <div style="margin-top:14px">
          <div class="problem" id="problem">—</div>

          <div class="row">
            <input id="answerInput" type="number" placeholder="Jawaban" />
            <button class="btn" id="btnSubmit">Kirim</button>
            <button class="btn" id="btnSkip">Lewati</button>
            <div class="stats">
              <div class="pill small">Skor: <span id="score">0</span></div>
              <div class="pill small">Sisa: <span id="remaining">0</span></div>
              <div class="pill small">Benar: <span id="correct">0</span></div>
              <div class="pill small">Salah: <span id="wrong">0</span></div>
            </div>
          </div>

          <div style="margin-top:10px">
            <div class="muted">Timer: <span id="timer">--</span></div>
          </div>
        </div>
      </section>

      <!-- Right: leaderboard dan info -->
      <aside class="card">
        <h3>Leaderboard Lokal</h3>
        <p class="muted">Nama & skor tersimpan di browser. Klik refresh untuk memuat ulang.</p>
        <div style="display:flex;gap:8px;margin:8px 0">
          <input id="nameField" placeholder="Nama" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:transparent;color:inherit" />
          <button class="btn" id="btnSaveScore">Simpan</button>
        </div>
        <div style="display:flex;gap:8px;margin-bottom:10px">
          <button class="btn" id="btnRefreshLB">Refresh Leaderboard</button>
          <button class="btn" id="btnClearLB">Hapus Leaderboard</button>
        </div>
        <div class="leaderboard" id="leaderboard"></div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0" />
        <div class="muted small">Petunjuk singkat:</div>
        <ul class="muted small">
          <li>Pilih mode dan kesulitan lalu klik <strong>MULAI</strong>.</li>
          <li>Masukkan jawaban lalu klik <strong>Kirim</strong> atau tekan Enter.</li>
          <li>Skor otomatis muncul — simpan dengan nama untuk disimpan ke leaderboard.</li>
        </ul>
      </aside>
    </main>

    <footer class="foreground">&copy; 2025 7C Portal — versi HTML (TinyFileManager dihapus)</footer>
  </div>

  <script>
    // ----------------------
    // Utils & State
    // ----------------------
    document.addEventListener('DOMContentLoaded', ()=>{
      const modeSelect = document.getElementById('modeSelect')
      const difficulty = document.getElementById('difficulty')
      const totalQ = document.getElementById('totalQ')
      const btnStart = document.getElementById('btnStart')
      const btnRestart = document.getElementById('btnRestart')
      const problemEl = document.getElementById('problem')
      const answerInput = document.getElementById('answerInput')
      const btnSubmit = document.getElementById('btnSubmit')
      const btnSkip = document.getElementById('btnSkip')
      const scoreEl = document.getElementById('score')
      const remainingEl = document.getElementById('remaining')
      const correctEl = document.getElementById('correct')
      const wrongEl = document.getElementById('wrong')
      const timerEl = document.getElementById('timer')
      const nameField = document.getElementById('nameField')
      const btnSaveScore = document.getElementById('btnSaveScore')
      const leaderboardEl = document.getElementById('leaderboard')
      const btnRefreshLB = document.getElementById('btnRefreshLB')
      const btnClearLB = document.getElementById('btnClearLB')
      const btnRefreshAll = document.getElementById('btnRefreshAll')

      let state = {
        question: null,
        answer: null,
        score: 0,
        correct: 0,
        wrong: 0,
        remaining: 0,
        total: 10,
        startTime: null,
        timerId: null,
        timePerQuestion: 20 // detik default
      }

      function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}

      function generateProblem(){
        const mode = modeSelect.value
        const diff = Number(difficulty.value)
        // range berdasarkan difficulty
        let range = [1,10]
        if(diff===1) range=[1,10]
        if(diff===2) range=[5,25]
        if(diff===3) range=[10,99]

        let a = randInt(range[0], range[1])
        let b = randInt(range[0], range[1])
        let question = ''
        let ans = 0
        if(mode==='add'){ question = `${a} + ${b}`; ans = a + b }
        if(mode==='sub'){ if(a<b){[a,b]=[b,a]} question = `${a} - ${b}`; ans = a - b }
        if(mode==='mul'){ question = `${a} × ${b}`; ans = a * b }
        if(mode==='div'){ // buat pembagian yang rapi (bilangan bulat)
          ans = randInt(range[0],range[1])
          let mul = randInt(range[0],range[1])
          a = ans * mul
          b = mul
          question = `${a} ÷ ${b}`
        }
        return {question,answer:ans}
      }

      function updateStats(){
        scoreEl.textContent = state.score
        remainingEl.textContent = state.remaining
        correctEl.textContent = state.correct
        wrongEl.textContent = state.wrong
      }

      function nextQuestion(){
        if(state.remaining<=0){
          endGame()
          return
        }
        const p = generateProblem()
        state.question = p.question
        state.answer = p.answer
        problemEl.textContent = p.question
        answerInput.value = ''
        answerInput.focus()
        resetTimer()
      }

      function startTimer(){
        clearInterval(state.timerId)
        let t = state.timePerQuestion
        timerEl.textContent = `${t}s`
        state.timerId = setInterval(()=>{
          t--
          timerEl.textContent = `${t}s`
          if(t<=0){
            clearInterval(state.timerId)
            // time up -> count wrong and next
            state.wrong++
            state.remaining--
            updateStats()
            setTimeout(nextQuestion,300)
          }
        },1000)
      }

      function resetTimer(){
        clearInterval(state.timerId)
        startTimer()
      }

      function startGame(){
        state.score = 0
        state.correct = 0
        state.wrong = 0
        state.total = Math.max(1, Number(totalQ.value) || 10)
        state.remaining = state.total
        // waktu per soal menyesuaikan difficulty
        const diff = Number(difficulty.value)
        state.timePerQuestion = diff===1?20:diff===2?15:10
        updateStats()
        nextQuestion()
      }

      function submitAnswer(){
        const raw = answerInput.value
        if(raw === '') return
        const ans = Number(raw)
        if(Number.isNaN(ans)) return
        if(ans === state.answer){
          state.correct++
          state.score += 10 + Math.max(0, Math.floor((state.timePerQuestion - Number(timerEl.textContent.replace('s','')))/1))
        } else {
          state.wrong++
          state.score = Math.max(0, state.score - 2)
        }
        state.remaining--
        updateStats()
        clearInterval(state.timerId)
        setTimeout(nextQuestion,250)
      }

      function skipQuestion(){
        state.wrong++
        state.remaining--
        updateStats()
        clearInterval(state.timerId)
        setTimeout(nextQuestion,200)
      }

      function endGame(){
        clearInterval(state.timerId)
        problemEl.textContent = 'Selesai! Simpan skor jika mau.'
        timerEl.textContent = '--'
        answerInput.value = ''
        answerInput.blur()
      }

      // ---------- Leaderboard (localStorage sederhana) ----------
      const LB_KEY = '7c_portal_leaderboard_v1'
      function loadLeaderboard(){
        try{
          const raw = localStorage.getItem(LB_KEY) || '[]'
          const arr = JSON.parse(raw)
          return Array.isArray(arr)?arr:[]
        }catch(e){return[]}
      }
      function saveLeaderboard(arr){
        localStorage.setItem(LB_KEY, JSON.stringify(arr))
      }
      function renderLeaderboard(){
        const arr = loadLeaderboard().slice().sort((a,b)=>b.score-a.score).slice(0,50)
        leaderboardEl.innerHTML = ''
        if(arr.length===0){ leaderboardEl.innerHTML = '<div class="muted">Belum ada skor.</div>';return }
        arr.forEach((it,idx)=>{
          const el = document.createElement('div')
          el.className = 'lb-item'
          el.innerHTML = `<div>#${idx+1} <strong>${escapeHtml(it.name)}</strong></div><div>${it.score}</div>`
          leaderboardEl.appendChild(el)
        })
      }
      function escapeHtml(s){return String(s).replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]))}

      btnSaveScore.addEventListener('click', ()=>{
        const name = (nameField.value || 'Anonim').trim().slice(0,32)
        const arr = loadLeaderboard()
        arr.push({name,score:state.score,t:Date.now()})
        saveLeaderboard(arr)
        renderLeaderboard()
      })

      btnRefreshLB.addEventListener('click', renderLeaderboard)
      btnClearLB.addEventListener('click', ()=>{
        if(confirm('Hapus semua leaderboard?')){ localStorage.removeItem(LB_KEY); renderLeaderboard() }
      })

      // tombol umum
      btnStart.addEventListener('click', startGame)
      btnRestart.addEventListener('click', startGame)
      btnSubmit.addEventListener('click', submitAnswer)
      btnSkip.addEventListener('click', skipQuestion)
      btnRefreshAll.addEventListener('click', ()=>{ renderLeaderboard(); alert('Di-refresh!') })

      // Admin button (TinyFileManager removed)
      const btnAdmin = document.getElementById('btnAdmin')
      const adminModal = document.getElementById('adminModal')
      const adminCloseBtn = document.getElementById('adminCloseBtn')
      const adminLoginBtn = document.getElementById('adminLoginBtn')
      if(btnAdmin){
        btnAdmin.addEventListener('click', ()=>{ if(adminModal) adminModal.style.display = 'block' })
      }
      if(adminCloseBtn){
        adminCloseBtn.addEventListener('click', ()=>{ if(adminModal) adminModal.style.display = 'none' })
      }
      if(adminLoginBtn){
        adminLoginBtn.addEventListener('click', ()=>{
          const u = document.getElementById('adminUser').value
          const p = document.getElementById('adminPass').value
          if(u === 'admin' && p === 'admin'){ alert('Login admin sukses (client-side demo).') }
          else { alert('Kredensial salah atau fitur server-side tidak tersedia. TinyFileManager telah dihapus.') }
          if(adminModal) adminModal.style.display = 'none'
        })
      }
      // close modal on ESC
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && adminModal) adminModal.style.display = 'none' })

      // Enter to submit
      answerInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ submitAnswer() } })

      // init
      renderLeaderboard()
      updateStats()

      // small UX: fokus input saat klik problem area
      problemEl.addEventListener('click', ()=>answerInput.focus())

      // Prevent any "stuck on loading" issues by ensuring DOMContentLoaded used instead of window.onload

    })

    // ----------------------
    // Interactive background canvas (touch + mouse)
    // ----------------------
    (function(){
      const canvas = document.getElementById('bgCanvas')
      const ctx = canvas.getContext('2d')
      let w=0,h=0,ratio=window.devicePixelRatio||1
      function resize(){
        w = canvas.clientWidth; h = canvas.clientHeight
        canvas.width = Math.floor(w*ratio); canvas.height = Math.floor(h*ratio)
        ctx.setTransform(ratio,0,0,ratio,0,0)
      }
      window.addEventListener('resize', resize)
      resize()

      const ripples = []
      function addRipple(x,y){
        ripples.push({x,y,r:0,life:0})
      }

      function draw(){
        ctx.clearRect(0,0,w,h)
        // subtle gradient background overlay
        const g = ctx.createLinearGradient(0,0,w,h)
        g.addColorStop(0,'rgba(79,70,229,0.04)')
        g.addColorStop(1,'rgba(3,16,33,0.04)')
        ctx.fillStyle = g
        ctx.fillRect(0,0,w,h)

        for(let i=ripples.length-1;i>=0;i--){
          const p = ripples[i]
          p.r += 2.6 + p.life*0.4
          p.life += 0.02
          const alpha = Math.max(0, 0.5 - p.life)
          if(alpha<=0.01){ ripples.splice(i,1); continue }
          ctx.beginPath()
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2)
          ctx.strokeStyle = `rgba(79,70,229,${alpha})`
          ctx.lineWidth = 2
          ctx.stroke()
        }
        requestAnimationFrame(draw)
      }
      draw()

      // support touch and mouse
      function pointer(e){
        const rect = canvas.getBoundingClientRect()
        const x = (e.touches?e.touches[0].clientX:e.clientX) - rect.left
        const y = (e.touches?e.touches[0].clientY:e.clientY) - rect.top
        addRipple(x,y)
      }
      window.addEventListener('pointerdown', pointer)
      window.addEventListener('touchstart', pointer, {passive:true})

    })();
  </script>
</body>
</html>
