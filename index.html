<script>
session_start();
// 7C-portal-v6-with-mathgame.php
// Gabungan portal 7C + Game Matematika Kelas 1 SMP (single-file)
// Cara pakai: simpan sebagai "7C-portal-v6-with-mathgame.php" di folder server (XAMPP/LAMP)
// Pastikan server menulis file untuk highscore (highscores.json) di direktori yang sama

define('HIGHSCORE_FILE', __DIR__ . '/highscores.json');

// Jika ada action -> tangani sebagai API JSON (soal, submit, highscores, reset)
if (isset($_GET['action'])) {
    header('Content-Type: application/json; charset=utf-8');
    $action = $_GET['action'];
    if ($action === 'reset') {
        // reset session
        $_SESSION = [];
        echo json_encode(['ok' => true]);
        exit;
    }
    if ($action === 'problem') {
        $difficulty = isset($_GET['difficulty']) ? intval($_GET['difficulty']) : 1;
        $problem = generate_problem($difficulty);
        // store the answer in session
        $nonce = uniqid('', true);
        if (!isset($_SESSION['problems'])) $_SESSION['problems'] = [];
        $_SESSION['problems'][$nonce] = ['answer' => $problem['answer'], 'expires' => time() + 90];
        // clean expired
        foreach ($_SESSION['problems'] as $k => $v) if ($v['expires'] < time()) unset($_SESSION['problems'][$k]);

        echo json_encode([
            'ok' => true,
            'nonce' => $nonce,
            'question_html' => $problem['question_html'],
            'hint' => $problem['hint'],
            'time_limit' => $problem['time_limit']
        ]);
        exit;
    }
    if ($action === 'submit') {
    $data = json_decode(file_get_contents('php://input'), true);
    $nonce = $data['nonce'] ?? '';
    $answer = trim($data['answer'] ?? '');
    $player = trim($data['player'] ?? 'Player');

    if (!$nonce || !isset($_SESSION['problems'][$nonce])) {
        echo json_encode(['ok' => false, 'error' => 'Problem expired atau tidak valid. Minta soal baru.']);
        exit;
    }
    $correct = $_SESSION['problems'][$nonce]['answer'];
    unset($_SESSION['problems'][$nonce]);

    if (!isset($_SESSION['score'])) $_SESSION['score'] = 0;
    if (!isset($_SESSION['streak'])) $_SESSION['streak'] = 0;
    if (!isset($_SESSION['lives'])) $_SESSION['lives'] = 3;

    $is_correct = compare_answers($answer, $correct);
    $delta = 0; $msg = '';
    if ($is_correct) {
        $_SESSION['streak'] += 1;
        $bonus = min($_SESSION['streak'], 5);
        $delta = 10 * $bonus;
        $_SESSION['score'] += $delta;
        $msg = 'Benar! +' . $delta . ' poin. Streak: ' . $_SESSION['streak'];
    } else {
        $_SESSION['streak'] = 0;
        $_SESSION['lives'] -= 1;
        $msg = 'Salah. Jawaban benar: ' . format_answer($correct) . '. Sisa nyawa: ' . $_SESSION['lives'];
    }

    $game_over = false;
    $requires_name = false;

    if ($_SESSION['lives'] <= 0) {
        $game_over = true;
        // tunda penyimpanan: simpan di session dan beri tahu client untuk kirim nama
        $_SESSION['last_score'] = $_SESSION['score'];
        $_SESSION['pending_score'] = true;
        $requires_name = true;
        // jangan panggil save_highscore di sini
    }

    echo json_encode([
        'ok' => true,
        'is_correct' => $is_correct,
        'score' => $_SESSION['score'],
        'streak' => $_SESSION['streak'],
        'lives' => $_SESSION['lives'],
        'delta' => $delta,
        'message' => $msg,
        'game_over' => $game_over,
        'requires_name' => $requires_name
    ]);
    exit;
}

    if ($action === 'highscores') {
        $list = load_highscores();
        echo json_encode(['ok' => true, 'list' => $list]);
        exit;
    }
    if ($action === 'save_name') {
    $data = json_decode(file_get_contents('php://input'), true);
    $name = trim($data['name'] ?? '');
    if ($name === '') {
        echo json_encode(['ok' => false, 'error' => 'Nama kosong']);
        exit;
    }
    if (!isset($_SESSION['pending_score']) || !$_SESSION['pending_score'] || !isset($_SESSION['last_score'])) {
        echo json_encode(['ok' => false, 'error' => 'Tidak ada skor yang menunggu penyimpanan']);
        exit;
    }
    // simpan highscore final
    save_highscore($name, intval($_SESSION['last_score']));
    // bersihkan tanda pending
    unset($_SESSION['pending_score'], $_SESSION['last_score']);
    echo json_encode(['ok' => true]);
    exit;
}

    // unknown action
    echo json_encode(['ok' => false, 'error' => 'Unknown action']);
    exit;
}

// ---------------------- Helper functions (game logic) ----------------------
function generate_problem($difficulty){
    $topics = [
        1 => ['add','sub','mul','div','frac'],
        2 => ['add','sub','mul','div','frac','percent'],
        3 => ['mul','div','frac','percent','equation']
    ];
    $pool = $topics[$difficulty] ?? $topics[1];
    $topic = $pool[array_rand($pool)];
    switch($topic){
        case 'add':
            $a = rand_for_diff(10, $difficulty);
            $b = rand_for_diff(10, $difficulty);
            return ['question_html'=>"$a + $b = ?", 'answer'=>strval($a+$b), 'hint'=>'Coba jumlahkan puluhan dan satuan.', 'time_limit'=>30];
        case 'sub':
            $a = rand_for_diff(20, $difficulty);
            $b = rand(1, max(1,intval($a*0.8)));
            return ['question_html'=>"$a - $b = ?", 'answer'=>strval($a-$b), 'hint'=>'Kurangkan angka lebih kecil dari angka besar.', 'time_limit'=>30];
        case 'mul':
            $a = rand_for_diff(5, $difficulty);
            $b = rand_for_diff(5, $difficulty);
            return ['question_html'=>"$a √ó $b = ?", 'answer'=>strval($a*$b), 'hint'=>'Kalikan seperti biasa. Ingat perkalian dasar.', 'time_limit'=>30];
        case 'div':
            $b = rand_for_diff(2, $difficulty);
            $res = rand_for_diff(5, $difficulty);
            $a = $b * $res;
            return ['question_html'=>"$a √∑ $b = ?", 'answer'=>strval($res), 'hint'=>'Bagi sampai habis ‚Äî hasilnya bilangan bulat.', 'time_limit'=>30];
        case 'frac':
            $num1 = rand(1,9); $den1 = rand(2,9);
            $num2 = rand(1,9); $den2 = rand(2,9);
            $op = (rand(0,1)==0)?'+':'-';
            $answer_fraction = compute_fraction($num1,$den1,$num2,$den2,$op);
            $q = "$num1/$den1 $op $num2/$den2 = ? (sederhanakan)";
            return ['question_html'=>$q, 'answer'=>$answer_fraction, 'hint'=>'Ubah ke penyebut sama lalu hitung pembilang.', 'time_limit'=>40];
        case 'percent':
            $base = rand_for_diff(50, $difficulty)*10;
            $pct = rand(5,50);
            $ans = ($base * $pct)/100;
            return ['question_html'=>"$pct% dari $base = ?", 'answer'=>format_answer($ans), 'hint'=>'Hitung persen: (persen/100) √ó nilai.', 'time_limit'=>35];
        case 'equation':
            $a = rand(1,5); $x = rand(1,10); $b = rand(-10,10);
            $c = $a*$x + $b;
            $q = "$a x + ($b) = $c. Cari x.";
            return ['question_html'=>$q, 'answer'=>strval($x), 'hint'=>'Selesaikan: x = (c - b)/a.', 'time_limit'=>45];
    }
}

function rand_for_diff($base, $difficulty){
    switch($difficulty){ case 1: return rand(1, $base); case 2: return rand(1, $base*2); default: return rand(1, $base*3); }
}

function compute_fraction($n1,$d1,$n2,$d2,$op){
    $num = $n1*$d2 + ($op=='+'?1:-1)*$n2*$d1;
    $den = $d1*$d2;
    if ($num == 0) return '0';
    // gcd
    if (function_exists('gmp_gcd')) $g = gmp_gcd(abs($num), $den); else $g = gcd(abs($num), $den);
    $num = $num / $g; $den = $den / $g;
    if ($den == 1) return strval($num);
    return "$num/$den";
}
function gcd($a,$b){ return $b==0?$a:gcd($b,$a%$b); }

function compare_answers($given, $correct){
    $g = trim($given); $c = trim($correct);
    if ($g === '') return false;
    if (strpos($c, '/') !== false){
        $cg = normalize_fraction($g);
        $cc = normalize_fraction($c);
        if ($cg === false || $cc === false) return false;
        return abs($cg - $cc) < 1e-9;
    }
    if (!is_numeric($g)) return false;
    return abs(floatval($g) - floatval($c)) < 1e-6;
}

function normalize_fraction($s){
    $s = trim($s); if ($s === '') return false;
    if (strpos($s, '/') !== false){ $p = explode('/', $s); if (count($p) != 2) return false; if (!is_numeric($p[0]) || !is_numeric($p[1])) return false; if (floatval($p[1]) == 0) return false; return floatval($p[0]) / floatval($p[1]); }
    if (!is_numeric($s)) return false; return floatval($s);
}

function format_answer($a){ if (is_numeric($a) && intval($a) == $a) return strval(intval($a)); return (string) $a; }

function save_highscore($name, $score){
    $list = load_highscores();
    $list[] = ['name'=>substr($name,0,30), 'score'=>intval($score), 'time'=>time()];
    usort($list, function($a,$b){ return $b['score'] <=> $a['score']; });
    $list = array_slice($list,0,50);
    file_put_contents(HIGHSCORE_FILE, json_encode($list, JSON_PRETTY_PRINT));
}

function load_highscores(){
    if (!file_exists(HIGHSCORE_FILE)) return [];
    $s = file_get_contents(HIGHSCORE_FILE);
    $arr = json_decode($s, true);
    if (!is_array($arr)) return [];
    return $arr;
}

</script>

<!doctype html>
<html lang="id">
<head>
  <link rel="shortcut icon" type="image/x-icon" href="https://files.cloudkuimages.guru/images/9Owut0x4.jpg" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>7 Cah Juara</title>
  <meta name="description" content="Website Kelas 7 Cah Juara" />
  <style>
/* (Portal CSS omitted here for brevity in canvas view) */
/* Minimal styles for embedded game to avoid conflicts */
/* Panel animation */
.member-panel{
  position:relative;
  will-change: transform, opacity;
  transition: none;
  backface-visibility: hidden;
}

/* entering / leaving classes used by JS */
.member-panel.enter{
  animation: panelIn 420ms cubic-bezier(.16,.9,.32,1) forwards;
}
.member-panel.leave{
  animation: panelOut 320ms cubic-bezier(.2,.9,.2,1) forwards;
}

@keyframes panelIn{
  0%{ opacity: 0; transform: translateX(18px) scale(.994); filter: blur(6px); }
  60%{ opacity: 1; transform: translateX(-6px) scale(1.002); filter: blur(0.6px); }
  100%{ opacity: 1; transform: translateX(0) scale(1); filter: blur(0); }
}
@keyframes panelOut{
  0%{ opacity: 1; transform: translateX(0) scale(1); filter: blur(0); }
  100%{ opacity: 0; transform: translateX(-18px) scale(.992); filter: blur(6px); }
}

/* Photo micro-animation */
.member-photo img{
  display:block;
  width:100%;
  height:100%;
  object-fit:cover;
  will-change: transform, opacity, filter;
  transition: transform 420ms cubic-bezier(.16,.9,.32,1), opacity 420ms ease, filter 420ms ease;
  transform-origin:center center;
  backface-visibility:hidden;
}

/* subtle glass / highlight when active */
.tab-btn.active { box-shadow: 0 12px 40px rgba(2,10,14,0.22); }

/* optional: make enter/leave smoother on small screens too */
@media (max-width:900px){
  @keyframes panelIn{ 0%{opacity:0;transform:translateY(8px) scale(.996)} 100%{opacity:1;transform:translateY(0) scale(1)} }
  @keyframes panelOut{ 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-8px)} }
}

/* === Improved Logo Rain === */
.rain-container{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:100005;
  overflow:hidden;
  mix-blend-mode:screen; /* nice glow blending */
}
/* Fade-out yang halus: dipakai saat animasi Web Animations selesai */
.logo-drop.fading{
  /* sedikit naik dan kecilkan serta hilang lembut */
  opacity: 0 !important;
  transform: translateY(12px) scale(0.92) rotate(12deg) !important;
  filter: blur(1.6px) brightness(0.96);
  transition: opacity 720ms cubic-bezier(.2,.9,.2,1), transform 720ms cubic-bezier(.2,.9,.2,1), filter 520ms ease;
  pointer-events: none;
}

.logo-drop{
  position:absolute;
  top:-160px;
  display:inline-block;
  will-change:transform,opacity,filter;
  transform-origin:center;
  user-select:none;
  -webkit-user-drag:none;
  box-shadow: 0 10px 26px rgba(2,8,16,0.35);
  filter: drop-shadow(0 6px 20px rgba(6,182,212,0.08));
  opacity:0.98;
  transition:filter .2s ease;
}
/* badge interior */
.logo-drop .badge{
  display:flex;
  align-items:center;
  justify-content:center;
  width:100%;
  height:100%;
  overflow:hidden;
  backface-visibility:hidden;
  -webkit-backface-visibility:hidden;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.06);
}

/* shapes */
.shape-circle{ border-radius:50%; }
.shape-round{ border-radius:14px; }
.shape-hex{ clip-path: polygon(25% 6.7%, 75% 6.7%, 100% 50%, 75% 93.3%, 25% 93.3%, 0% 50%); }

/* inner logo image */
.logo-drop img{
  width:84%;
  height:84%;
  object-fit:cover;
  pointer-events:none;
  border-radius:8px;
  display:block;
  transform-origin:center;
}

/* soft glow overlay */
.logo-drop::after{
  content:'';
  position:absolute;
  inset:0;
  border-radius:inherit;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(6,182,212,0.06));
  mix-blend-mode:overlay;
  pointer-events:none;
  opacity:0.65;
}

/* small bounce on hover when pointer allowed (just in case) */
.logo-square:hover { transform:translateY(-4px) scale(1.01); transition:transform .18s ease; }

/* helper for hidden when removed */
.logo-drop.removing{ opacity:0; transform:translateY(20px) scale(.8) rotate(20deg); transition:all .35s ease; }

.game-wrap{margin-top:6px}
.game-area{display:grid;grid-template-columns:1fr 300px;gap:12px}
.game-card{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
.question{font-size:20px;font-weight:800;margin:8px 0}
.input-row{display:flex;gap:8px}
.input-row input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.btn{padding:8px 10px;border-radius:8px;border:0;background:linear-gradient(90deg,#06b6d4,#0ea5a4);color:#02121a;cursor:pointer;font-weight:800}
.small{font-size:13px;color:var(--muted)}
@media(max-width:900px){.game-area{grid-template-columns:1fr}}

/* Member tabs styles */
.member-tabs{ display:flex; gap:12px; align-items:flex-start; }
.tabs-list{ width:220px; display:flex; flex-direction:column; gap:8px; }
.tab-btn{ display:flex; gap:10px; align-items:center; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); cursor:pointer; text-align:left; color:inherit; transition:transform .18s ease, box-shadow .18s ease; }
.tab-btn img{ width:48px; height:48px; object-fit:cover; border-radius:8px; flex-shrink:0; }
.tab-btn .meta{ display:flex; flex-direction:column; }
.tab-btn .name{ font-weight:800; }
.tab-btn .role{ font-size:12px; color:var(--muted); margin-top:2px; }

.tab-btn.active, .tab-btn:focus{ box-shadow:0 8px 30px rgba(2,10,12,0.18); transform:translateX(4px); border-color: rgba(14,165,164,0.18); background:linear-gradient(90deg,var(--accent-2),var(--accent-1)); color:#02121a; }

.tabs-panel{ flex:1; min-height:120px; display:flex; align-items:flex-start; }
.member-panel{ display:flex; gap:12px; align-items:flex-start; width:100%; padding:8px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02); }
.member-panel[hidden]{ display:none !important; }
.member-photo img{ width:160px; height:160px; object-fit:cover; border-radius:12px; box-shadow:0 12px 40px rgba(2,6,23,0.35); }
.member-info{ flex:1; }
.member-info h4{ margin:0 0 6px 0; font-size:1.05rem; }
.member-links a{ color:var(--accent-3); text-decoration:none; margin-right:8px; }
@media(max-width:900px){ .member-tabs{ flex-direction:column; } .tabs-list{ width:100%; flex-direction:row; overflow:auto; } .tab-btn{ min-width:160px; } .tabs-panel{ width:100%; } .member-photo img{ width:120px; height:120px; } }
// Improved member tab switching with animations
(function(){
  const container = document.getElementById('memberTabs');
  if(!container) return;
  const buttons = Array.from(container.querySelectorAll('.tab-btn'));
  const panels = Array.from(container.querySelectorAll('.member-panel'));

  // helper to find visible panel
  function visiblePanel(){
    return panels.find(p => !p.hasAttribute('hidden'));
  }

  function activate(memberKey){
    const current = visiblePanel();
    const target = panels.find(p => p.dataset.member === memberKey);
    if(!target) return;
    if(current === target) {
      // small pulse on image to show re-selection
      const img = target.querySelector('.member-photo img');
      if(img) img.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}], {duration:360, easing:'ease-out'});
      updateButtons(memberKey);
      return;
    }

    // disable tab buttons briefly to avoid spamming
    buttons.forEach(b => b.disabled = true);

    // animate current out (if exists)
    if(current){
      current.classList.add('leave');
      const onOutEnd = () => {
        current.classList.remove('leave');
        current.setAttribute('hidden','');
        current.removeEventListener('animationend', onOutEnd);
        // now animate target in
        showTarget();
      };
      current.addEventListener('animationend', onOutEnd);
    } else {
      // no current visible -> just show target
      showTarget();
    }

    function showTarget(){
      // reveal target and animate in
      target.removeAttribute('hidden');
      target.classList.add('enter');

      // photo micro-animation using Web Animations API for crisp motion
      const img = target.querySelector('.member-photo img');
      if(img){
        // start with a slightly larger, rotated state using immediate styles (visual)
        img.style.transform = 'scale(1.06) rotate(2deg)';
        img.style.opacity = '0.0';
        // animate into place
        img.animate([
          { transform: 'scale(1.06) rotate(2deg)', opacity: 0 },
          { transform: 'scale(1.00) rotate(0deg)', opacity: 1 }
        ], { duration: 460, easing: 'cubic-bezier(.16,.9,.32,1)', fill: 'forwards' });
      }

      const onInEnd = () => {
        target.classList.remove('enter');
        target.removeEventListener('animationend', onInEnd);
        // re-enable buttons
        buttons.forEach(b => b.disabled = false);
      };
      target.addEventListener('animationend', onInEnd);

      // update left-side buttons state immediately for accessibility
      updateButtons(memberKey);
    }
  }

  function updateButtons(activeKey){
    buttons.forEach(b => {
      const is = b.dataset.member === activeKey;
      b.classList.toggle('active', is);
      b.setAttribute('aria-selected', is ? 'true' : 'false');
    });
  }

  // wire up events and keyboard navigation
  buttons.forEach((btn, idx) => {
    btn.addEventListener('click', ()=> activate(btn.dataset.member));
    btn.addEventListener('keydown', (e) => {
      if(e.key === 'ArrowDown' || e.key === 'ArrowRight'){ e.preventDefault(); buttons[(idx+1)%buttons.length].focus(); }
      if(e.key === 'ArrowUp' || e.key === 'ArrowLeft'){ e.preventDefault(); buttons[(idx-1+buttons.length)%buttons.length].focus(); }
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
    });
  });

  // initial activate for the preselected active tab (or first)
  const initial = container.querySelector('.tab-btn.active') || buttons[0];
  if(initial) activate(initial.dataset.member);

})();

  </style>
</head>
<body>

  <!-- PRELOADER & APP html... (kept from original portal) -->
  <?php
// 7C-portal-v6-with-admin-login.php
// Versi v6 ‚Äî ditambah tombol Admin (login TinyFileManager)
// Simpan sebagai .php jika ingin tanggal server (digunakan di bawah)
?>
<!doctype html>
<html lang="id">
<head>
  <link rel="shortcut icon" type="image/x-icon" href="https://files.cloudkuimages.guru/images/9Owut0x4.jpg" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>7 Cah Juara</title>
  <meta name="description" content="Website Kelas 7 Cah Juara" />
  <style>
/* ===========================================================================
   7C Portal v6 ‚Äî Stylesheet + Admin modal
   =========================================================================== */
:root{
  --bg-1: #04121a; --bg-2: #072028; --card-bg: rgba(255,255,255,0.03); --glass: rgba(255,255,255,0.04);
  --accent-1: #06b6d4; --accent-2: #0ea5a4; --accent-3: #7ee3d6;
  --text: #e8f6fb; --muted: #98b6c4; --shadow-1: 0 12px 34px rgba(2,6,23,0.5);
  --radius: 14px; --max-w: 1200px; --ui-size: 15px; --menu-z: 99999;
}
:root[data-theme="light"]{ --bg-1:#f6fbff; --bg-2:#eef8ff; --card-bg:rgba(10,20,30,0.04); --glass:rgba(255,255,255,0.6); --text:#072035; --muted:#475569; --shadow-1:0 12px 34px rgba(2,6,23,0.06); }
*{box-sizing:border-box}html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:var(--text);-webkit-font-smoothing:antialiased;overflow-x:hidden}
img{max-width:100%;height:auto;display:block}
.hidden{display:none}.center{display:flex;align-items:center;justify-content:center}.container{width:100%;max-width:var(--max-w);margin:0 auto;padding:20px}
#preloader{position:fixed;inset:0;z-index:100000;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));display:flex;align-items:center;justify-content:center}
#preloader .box{width:110px;height:110px;border-radius:18px;background:linear-gradient(180deg,var(--accent-2),var(--accent-1));box-shadow:var(--shadow-1);display:flex;align-items:center;justify-content:center}
#preloader .ring{width:56px;height:56px;border-radius:50%;border:3px solid rgba(2,10,12,0.12);animation:rotateScale 1400ms linear infinite}
#preloader .ring::after{content:'';width:12px;height:12px;border-radius:50%;background:#02121a;display:block;margin:auto;transform:translateY(-6px)}
@keyframes rotateScale{0%{transform:rotate(0) scale(0.86)}50%{transform:rotate(180deg) scale(1)}100%{transform:rotate(360deg) scale(0.86)}}
.bg-wrap{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}.blob{position:absolute;border-radius:50%;filter:blur(64px);opacity:0.86;mix-blend-mode:screen;will-change:transform}
.blob.b1{width:900px;height:900px;left:-320px;top:-260px;background:radial-gradient(circle at 25% 30%, rgba(6,182,212,0.94), rgba(6,182,212,0.12) 35%, transparent 60%);animation:blobMove1 26s ease-in-out infinite}
.blob.b2{width:680px;height:680px;right:-200px;top:40px;background:radial-gradient(circle at 60% 40%, rgba(14,165,164,0.92), rgba(14,165,164,0.12) 35%, transparent 60%);animation:blobMove2 32s ease-in-out infinite}
.blob.b3{width:520px;height:520px;left:6%;bottom:-260px;background:radial-gradient(circle at 50% 50%, rgba(15,120,140,0.88), rgba(15,120,140,0.08) 40%, transparent 70%);animation:blobMove3 20s ease-in-out infinite}
@keyframes blobMove1{0%{transform:translate(0,0) rotate(0deg)}33%{transform:translate(28px,22px) rotate(3deg)}66%{transform:translate(-18px,28px) rotate(-2deg)}100%{transform:none}}
@keyframes blobMove2{0%{transform:none}50%{transform:translate(-28px,-18px) rotate(-6deg)}100%{transform:none}}
@keyframes blobMove3{0%{transform:none}50%{transform:translate(12px,-36px)}100%{transform:none}}
.ring{position:absolute;border-radius:50%;border:2px solid rgba(255,255,255,0.02);box-shadow:0 6px 40px rgba(6,22,34,0.12)}
.ring.r1{width:960px;height:960px;right:-420px;bottom:-420px;animation:spin 56s linear infinite}
.ring.r2{width:640px;height:640px;left:-300px;bottom:-320px;animation:spinRev 72s linear infinite}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spinRev{from{transform:rotate(360deg)}to{transform:rotate(0deg)}}
canvas#network{position:absolute;inset:0;width:100%;height:100%;z-index:0;opacity:0.32;pointer-events:none}
.app{position:relative;z-index:10;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:28px 16px}.panel{width:100%;max-width:var(--max-w)}
.header{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:var(--card-bg);box-shadow:var(--shadow-1);backdrop-filter:blur(6px);position:relative;margin-bottom:18px;z-index:10}
.left-group{display:flex;align-items:center;gap:12px}.equals{width:56px;height:56px;border-radius:12px;border:0;background:linear-gradient(180deg,var(--accent-2),var(--accent-1));display:inline-grid;place-items:center;color:#02121a;cursor:pointer;box-shadow:0 8px 24px rgba(2,8,10,0.12)}
.equals .eq{width:26px;height:16px;position:relative}.equals .eq::before,.equals .eq::after{content:'';position:absolute;left:0;right:0;height:3px;background:rgba(2,10,12,0.95);border-radius:2px}.equals .eq::before{top:0}.equals .eq::after{bottom:0}
.logo-square{width:96px;height:96px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;justify-content:center;margin:auto;box-shadow:0 8px 28px rgba(2,6,23,0.35);z-index:12}
.logo-square img{width:86%;height:86%;object-fit:cover;border-radius:10px}
.controls{display:flex;align-items:center;gap:10px}
.theme-btn{padding:8px 10px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer;font-weight:700}
/* Admin button style */
.admin-btn{padding:8px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#02121a;font-weight:800;cursor:pointer}
/* modal for admin iframe */
.admin-modal-backdrop{position:fixed;inset:0;background:rgba(2,6,10,0.55);display:none;z-index:100001;align-items:center;justify-content:center}
.admin-modal{width:92%;max-width:1100px;height:80vh;background:var(--card-bg);border-radius:12px;padding:10px;box-shadow:0 28px 80px rgba(2,6,23,0.7);backdrop-filter:blur(6px);display:flex;flex-direction:column}
.admin-modal header{display:flex;align-items:center;justify-content:space-between;padding:6px 8px}
.admin-modal .frame-wrap{flex:1;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);background:#02121a}
.admin-modal iframe{width:100%;height:100%;border:0}
.admin-modal .notice{font-size:13px;color:var(--muted);padding:8px}
.admin-modal .actions{display:flex;gap:8px}
.admin-modal .btn{padding:8px 10px;border-radius:8px;border:0;background:transparent;color:var(--text);cursor:pointer}
.menu-panel{position:fixed;left:12px;top:72px;min-width:360px;max-width:calc(100% - 48px);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;box-shadow:0 22px 60px rgba(2,6,23,0.6);backdrop-filter:blur(8px);transform-origin:top left;opacity:0;transform:translateY(-8px) scale(.98);pointer-events:none;transition:opacity 220ms ease, transform 220ms cubic-bezier(.2,.9,.2,1);z-index: var(--menu-z);}
.menu-panel.open{opacity:1;transform:translateY(0) scale(1);pointer-events:auto}
.menu-search{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.menu-search input{flex:1;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
.menu-list{display:flex;flex-direction:column;gap:8px;max-height:60vh;overflow:auto;padding-right:6px}
.menu-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;border:1px solid rgba(255,255,255,0.02);transition:transform 220ms cubic-bezier(.2,.9,.2,1), box-shadow 220ms;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
.menu-item .ic{width:44px;height:44px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);display:inline-grid;place-items:center;font-weight:800}.menu-item:hover{transform:translateX(6px);box-shadow:0 8px 28px rgba(2,6,23,0.28)}.menu-item.active{background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#02121a;font-weight:800}
.menu-item[data-order]{opacity:0;transform:translateX(-8px);animation:menuIn 420ms forwards}@keyframes menuIn{to{opacity:1;transform:none}}
.menu-item:focus{outline:3px solid rgba(6,182,212,0.14);outline-offset:3px}
.main-grid{display:grid;grid-template-columns:1fr;gap:18px}@media(min-width:980px){.main-grid{grid-template-columns:320px 1fr}}
.card{background:var(--card-bg);border-radius:12px;padding:14px;box-shadow:var(--shadow-1);backdrop-filter:blur(6px)}
.scroll{max-height:64vh;overflow:auto;padding-right:8px}
.roles{display:grid;gap:8px}.role{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.01), transparent);font-weight:700}
.piket{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}@media(min-width:700px){.piket{grid-template-columns:repeat(2,1fr)}}
.page{opacity:1;transform:none;transition:opacity 420ms ease, transform 420ms cubic-bezier(.2,.9,.2,1)}.page.hidden{display:none;opacity:0}
.card.float{animation:floatCard 6s ease-in-out infinite}@keyframes floatCard{0%{transform:translateY(0)}50%{transform:translateY(6px)}100%{transform:translateY(0)}}
.ripple{position:relative;overflow:hidden}.ripple:after{content:'';position:absolute;border-radius:50%;transform:scale(0);opacity:0;transition:transform 600ms ease, opacity 600ms ease}.ripple:active:after{transform:scale(8);opacity:0}
.hint{color:var(--muted);font-size:13px}
@media(max-width:420px){.menu-panel{left:8px;right:8px;top:60px}.menu-item{padding:10px}}
  </style>
</head>
<body>

  <!-- PRELOADER -->
  <div id="preloader" role="status" aria-live="polite">
    <div class="box">
      <div class="ring"></div>
    </div>
  </div>

  <!-- BACKGROUND LAYERS (visuals) -->
  <div class="bg-wrap" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="ring r1"></div>
    <div class="ring r2"></div>
    <canvas id="network"></canvas>
  </div>

  <!-- APP -->
  <div class="app" id="app">
    <div class="panel container">

      <!-- HEADER -->
      <header class="header" role="banner" aria-label="Header portal">
        <div class="left-group">
          <button id="equalsBtn" class="equals ripple" aria-expanded="false" aria-controls="menuPanel" aria-label="Buka navigasi">
            <span class="eq" aria-hidden="true"></span>
          </button>
          <div style="display:flex;flex-direction:column">
            <div style="font-weight:900">7 Cah Juara</div>
            <div class="hint">Website kelas 7 Cah Juara ‚Äî tekan tombol "=" untuk membuka menu</div>
          </div>
        </div>

        <div class="logo-square" aria-hidden="true">
          <img src="https://files.cloudkuimages.guru/images/9Owut0x4.jpg" alt="Logo 7C" onerror="this.style.display='none'"/>
        </div>

        <div class="controls">
          <button id="themeToggle" class="theme-btn" aria-pressed="false" title="Toggle theme">üåì Tema</button>
          <!-- ADMIN LOGIN BUTTON -->
          <button id="adminBtn" class="admin-btn ripple" aria-haspopup="dialog" aria-controls="adminModal" title="Login Admin">üîí Admin</button>
        </div>
      </header>

      <!-- MENU PANEL (fixed & top) -->
      <nav id="menuPanel" class="menu-panel" role="menu" aria-hidden="true">
        <div class="menu-search">
          <input id="menuSearch" type="search" placeholder="Cari menu..." aria-label="Cari menu" />
          <div class="hint">Menu Search</div>
        </div>
        <div id="menuList" class="menu-list" role="menu"></div>
      </nav>

      <!-- MAIN GRID -->
      <main class="main-grid" role="main">

        <!-- SIDEBAR -->
        <aside class="card float" aria-label="Informasi singkat">
        <div class="hint">Tanggal server: <?php echo date('d F Y'); ?></div>
        <br>
          <h4 style="margin:0 0 8px 0">Info Singkat</h4>
          <p class="hint" style="margin:0 0 12px 0">Menu: pilih slide (Ringkasan, Jadwal, Pengumuman, Kegiatan). Tema tersimpan di perangkatmu.</p>
          <div style="margin-top:12px">
            <h5 style="margin:0 0 8px 0">Kontak</h5>
            <p style="margin:0;color:var(--muted)">Ketua: Athar</p>
            <p style="margin:0;color:var(--muted)">Wakil: Bilvan</p>
            <br>
            <h5 style="margin:0 0 8px 0">Follow on</h5>
            <input type="image" src="https://upload.wikimedia.org/wikipedia/commons/9/95/Instagram_logo_2022.svg" style="width: 10%;max-width= 10px" onclick="location.href='https://www.instagram.com/7che_pradnyasiwi';"/>
            <input type="image" src="https://upload.wikimedia.org/wikipedia/commons/8/88/TikTok_Icon.png" style="width: 10%;max-width= 10px" onclick="location.href='https://www.tiktok.com/@7che_pradnyasiwi';"/>
            <input type="image" src="https://upload.wikimedia.org/wikipedia/commons/1/19/WhatsApp_logo-color-vertical.svg" style="width: 10%;max-width= 10px" onclick="location.href='https://whatsapp.com/channel/0029Vb6FIBA3QxRudWNFvP0q';"/>
            <input type="image" src="https://upload.wikimedia.org/wikipedia/commons/8/84/Spotify_icon.svg" style="width: 10%;max-width= 10px" onclick="location.href='https://open.spotify.com/playlist/0KftOxEFfZcippIvANeC29?si=H9E2mJZLRIOYmcJlkP3Vmw&pi=H193RRzeRr2cJ';"/>
            <br>
            <br>
            <p style="margin:0;color:var(--muted)">&copy;7CAHJUARA</p>
          </div>
        </aside>

        <!-- CONTENT -->
        <section>
          <article id="ringkasan" class="card page" aria-labelledby="ringkasanTitle">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:8px">
              <div>
                <h2 id="ringkasanTitle" style="margin:0;font-size:1.05rem">Ringkasan Kelas</h2>
                <div class="hint">Pengurus & Jadwal Piket</div>
              </div>
            </div>

            <h3 style="margin:6px 0">‚≠êÔ∏è Pengurus kelas 7 Cah Juara</h3>
            <div class="roles" role="list">
            <!-- START: Member tabs (ganti foto di attribute src sesuai kebutuhan) -->
<div class="member-tabs" id="memberTabs" aria-label="Pengurus kelas - gallery">
  <div class="tabs-list" role="tablist" aria-orientation="vertical">
    <button class="tab-btn active" role="tab" aria-selected="true" data-member="athar" id="tab-athar">
      <img src="images/members/athar.jpg" alt="Foto Athar" onerror="this.src='https://via.placeholder.com/72?text=Athar'"/>
      <div class="meta"><div class="name">Athar</div><div class="role">Ketua Kelas</div></div>
    </button>

    <button class="tab-btn" role="tab" aria-selected="false" data-member="bilvan" id="tab-bilvan">
      <img src="images/members/bilvan.jpg" alt="Foto Bilvan" onerror="this.src='https://via.placeholder.com/72?text=Bilvan'"/>
      <div class="meta"><div class="name">Bilvan</div><div class="role">Wakil Ketua</div></div>
    </button>

    <button class="tab-btn" role="tab" aria-selected="false" data-member="wira" id="tab-wira">
      <img src="images/members/wira.jpg" alt="Foto Wira Damar" onerror="this.src='https://via.placeholder.com/72?text=Wira'"/>
      <div class="meta"><div class="name">Wira Damar</div><div class="role">Sekretaris 1</div></div>
    </button>

    <button class="tab-btn" role="tab" aria-selected="false" data-member="alea" id="tab-alea">
      <img src="images/members/alea.jpg" alt="Foto Alea" onerror="this.src='https://via.placeholder.com/72?text=Alea'"/>
      <div class="meta"><div class="name">Alea</div><div class="role">Sekretaris 2</div></div>
    </button>

    <button class="tab-btn" role="tab" aria-selected="false" data-member="lentera" id="tab-lentera">
      <img src="images/members/lentera.jpg" alt="Foto Lentera" onerror="this.src='https://via.placeholder.com/72?text=Lentera'"/>
      <div class="meta"><div class="name">Lentera</div><div class="role">Bendahara 1</div></div>
    </button>

    <button class="tab-btn" role="tab" aria-selected="false" data-member="gina" id="tab-gina">
      <img src="images/members/gina.jpg" alt="Foto Gina" onerror="this.src='https://via.placeholder.com/72?text=Gina'"/>
      <div class="meta"><div class="name">Gina</div><div class="role">Bendahara 2</div></div>
    </button>
  </div>

  <div class="tabs-panel">
    <!-- detail panel per member (isi awal sesuai tab pertama - Athar) -->
    <div class="member-panel active" data-member="athar" role="tabpanel" aria-labelledby="tab-athar">
      <div class="member-photo"><img src="https://files.cloudkuimages.guru/images/j0EXnlaL.jpg" alt="Athar" onerror="this.src='https://via.placeholder.com/300?text=Athar'"/></div>
      <div class="member-info">
        <h4>Athar</h4>
        <div class="small">Ketua Kelas</div>
        <p class="hint">Profil singkat: Ketua kelas yang baik, mantap, sehat, jos, dan sergep.</p>
        <div class="member-links">
          <a href="#" class="small">Profil</a> ¬∑ <a href="https://wa.me/6285943549495" class="small">Kontak</a>
        </div>
      </div>
    </div>

    <div class="member-panel" data-member="bilvan" role="tabpanel" aria-labelledby="tab-bilvan" hidden>
      <div class="member-photo"><img src="https://files.cloudkuimages.guru/images/BdV5GiLC.jpg" alt="Bilvan" onerror="this.src='https://via.placeholder.com/300?text=Bilvan'"/></div>
      <div class="member-info">
        <h4>Bilvan</h4>
        <div class="small">Wakil Ketua</div>
        <p class="hint">Profil singkat: Ipan imut, butuh disayang KFA.</p>
        <div class="member-links"><a href="#" class="small">Profil</a> ¬∑ <a href="https://wa.me/6281299962424" class="small">Kontak</a></div>
      </div>
    </div>

    <div class="member-panel" data-member="wira" role="tabpanel" aria-labelledby="tab-wira" hidden>
      <div class="member-photo"><img src="https://files.cloudkuimages.guru/images/bvKU6WE1.jpg" alt="Wira Damar" onerror="this.src='https://via.placeholder.com/300?text=Wira'"/></div>
      <div class="member-info">
        <h4>Wira Damar</h4>
        <div class="small">Sekretaris 1</div>
        <p class="hint">Profil singkat: Penulis handal, partner sekret nya Alea.</p>
        <div class="member-links"><a href="#" class="small">Profil</a> ¬∑ <a href="https://wa.me/6282144520062" class="small">Kontak</a></div>
      </div>
    </div>

    <div class="member-panel" data-member="alea" role="tabpanel" aria-labelledby="tab-alea" hidden>
      <div class="member-photo"><img src="https://files.cloudkuimages.guru/images/hreAoScB.jpg" alt="Alea" onerror="this.src='https://via.placeholder.com/300?text=Alea'"/></div>
      <div class="member-info">
        <h4>Alea</h4>
        <div class="small">Sekretaris 2</div>
        <p class="hint">Profil singkat: Penulis handal, partner sekret nya Damar.</p>
        <div class="member-links"><a href="#" class="small">Profil</a> ¬∑ <a href="https://wa.me/6282132008671" class="small">Kontak</a></div>
      </div>
    </div>

    <div class="member-panel" data-member="lentera" role="tabpanel" aria-labelledby="tab-lentera" hidden>
      <div class="member-photo"><img src="https://files.cloudkuimages.guru/images/V2uCcKaZ.jpg" alt="Lentera" onerror="this.src='https://via.placeholder.com/300?text=Lentera'"/></div>
      <div class="member-info">
        <h4>Lentera</h4>
        <div class="small">Bendahara 1</div>
        <p class="hint">Profil singkat: Bendahara baik, tidak pernah berbuat jahat.</p>
        <div class="member-links"><a href="#" class="small">Profil</a> ¬∑ <a href="https://wa.me/6281326775876" class="small">Kontak</a></div>
      </div>
    </div>

    <div class="member-panel" data-member="gina" role="tabpanel" aria-labelledby="tab-gina" hidden>
      <div class="member-photo"><img src="https://files.cloudkuimages.guru/images/Ta2Wn8LC.jpg" alt="Gina" onerror="this.src='https://via.placeholder.com/300?text=Gina'"/></div>
      <div class="member-info">
        <h4>Gina</h4>
        <div class="small">Bendahara 2</div>
        <p class="hint">Profil singkat: Bendahara baik, tidak pernah berbuat jahat.</p>
        <div class="member-links"><a href="#" class="small">Profil</a> ¬∑ <a href="https://wa.me/6287724196463" class="small">Kontak</a></div>
      </div>
    </div>

  </div>
</div>
<!-- END: Member tabs -->

            </div>

            <h3 style="margin-top:14px">Jadwal Piket üßπ</h3>
            <div class="piket">
              <div class="card"><strong>Senin</strong><div style="color:var(--muted);margin-top:6px">Athar, Laiq, Wira, Nadin, Alista, Gina, Zahira</div></div>
              <div class="card"><strong>Selasa</strong><div style="color:var(--muted);margin-top:6px">Alfi, Bilvan, Abi, Alea, Naya, Cesta</div></div>
              <div class="card"><strong>Rabu</strong><div style="color:var(--muted);margin-top:6px">Farel, Hamza, Affan, Rizky, Syifa, Mayang, Jyo</div></div>
              <div class="card"><strong>Kamis</strong><div style="color:var(--muted);margin-top:6px">Damar, Varo, Saguna, Ciesta, Inca, Kikan</div></div>
              <div class="card"><strong>Jumat</strong><div style="color:var(--muted);margin-top:6px">Nafis, Fatih, Faiz, Narra, Dila, Tera</div></div>
            </div>
          </article>

          <article id="jadwal" class="card page hidden" style="margin-top:18px">
            <h3>Jadwal Pelajaran</h3>
            <div class="scroll" style="margin-top:8px">
              <img src="https://files.cloudkuimages.guru/images/LceJlQzn.jpg" alt="Jadwal pelajaran" onerror="this.style.display='Tidak Ada Jadwal'">
              <h3>Jadwal Revisi</h3>
              <img src="https://files.cloudkuimages.guru/images/3gi1es0L.jpg" alt="Jadwal pelajaran" onerror="this.style.display='Tidak Ada Jadwal'">
            </div>
          </article>

          <article id="pengumuman" class="card page hidden" style="margin-top:18px">
            <h3>Pengumuman</h3>
            <ul>
              <li>MBG diambil saat istirahat pertama di sebelah perpustakaan.</li>
              <li>Hari Selasa 07.20‚Äî08.00 koordinasi Open House FEP.</li>
              <li>Hari Kamis ulangan Bahasa Indonesia teks deskripsi jam 08.40‚Äî10.00.</li>
              <li>Hari Kamis ulangan informatika. (Kayaknya)</li>
              <li>Hari Jumat libur Maulid Nabi Muhammad SAW.</li>
            </ul>
          </article>

          <article id="kegiatan" class="card page hidden" style="margin-top:18px">
            <h3>Kegiatan Mendatang</h3>
            <ol>
              <li>Hari Jumat libur Maulid Nabi Muhammad SAW.</li>
              <li>MBG diambil saat istirahat pertama.</li>
              <li>Open House FEP.</li>
            </ol>
          </article>
          
          <article id="pr" class="card page hidden" style="margin-top:18px">
            <h3>TUGAS 7 CAH JUARA</h3>
            <ul>
              <li>Tugas PJOK, dikumpulkan saat pelajaran PJOK | Membuat gambar lapangan basket beserta ukuran, posisi pemain, dan peraturan.</li>
            </ul>
          </article>
          
            <article id="developer" class="card page hidden" style="margin-top:18px">
            <h3>Developer Tercinta</h3>
            <ul>
            <li>Thanks to God.</li>
            <li>Varo ‚Äî Owner</li>
            <li>Bilvan ‚Äî Designer (KFA)</li>
            </ul>
          </article>
          <article id="mathgame" class="card page hidden" style="margin-top:18px">
            <h3>Belajar sambil bermain :)</h3>
            
          </article>

        </section>

      </main>

    </div>
  </div>

  <!-- ADMIN MODAL (iframe to tinyfilemanager) -->
  <div id="adminBackdrop" class="admin-modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="admin-modal" id="adminModal">
      <header>
        <div style="font-weight:800">Admin ‚Äî File Manager</div>
        <div style="display:flex;align-items:center;gap:8px">
          <button id="closeAdmin" class="btn" aria-label="Tutup admin">‚úñ</button>
        </div>
      </header>
      <div class="frame-wrap">
        <iframe id="adminFrame" title="TinyFileManager" src="about:blank"></iframe>
      </div>
      <div style="padding-top:8px;display:flex;justify-content:flex-end;gap:8px">
        <button id="openNewTab" class="btn">Buka di Tab Baru</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS: interactions, animations, theme, canvas network -->
  <script>
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const now = () => new Date().getTime();

// Preloader
(function preloader(){
  const pre = document.getElementById('preloader');
  function hide(){ if(pre){ pre.style.opacity='0'; pre.style.pointerEvents='none'; setTimeout(()=>pre.remove(),550); } }
  window.addEventListener('load', ()=>{ setTimeout(hide, 420); });
  setTimeout(hide, 4000);
})();

// network canvas
(function networkCanvas(){
  const canvas = document.getElementById('network'); if(!canvas) return; const ctx = canvas.getContext('2d'); let dpr = window.devicePixelRatio || 1; let W = 0, H = 0; let pts = [];
  function init(){ dpr = window.devicePixelRatio || 1; W = canvas.width = innerWidth * dpr; H = canvas.height = innerHeight * dpr; canvas.style.width = innerWidth + 'px'; canvas.style.height = innerHeight + 'px'; ctx.setTransform(dpr,0,0,dpr,0,0); pts = []; const count = Math.max(14, Math.floor((innerWidth * innerHeight) / 110000)); for(let i=0;i<count;i++){ pts.push({x:Math.random()*innerWidth, y:Math.random()*innerHeight, vx:(Math.random()-0.5)*0.6, vy:(Math.random()-0.5)*0.6}); } }
  function frame(){ ctx.clearRect(0,0,innerWidth,innerHeight); for(let i=0;i<pts.length;i++){ const a = pts[i]; a.x += a.vx; a.y += a.vy; if(a.x < 0 || a.x > innerWidth) a.vx *= -1; if(a.y < 0 || a.y > innerHeight) a.vy *= -1; }
    for(let i=0;i<pts.length;i++){ for(let j=i+1;j<pts.length;j++){ const a=pts[i], b=pts[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=Math.hypot(dx,dy); if(d<140){ ctx.strokeStyle = 'rgba(14,165,164,' + (0.14*(1 - d/140)).toFixed(3) + ')'; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); } } }
    for(const p of pts){ ctx.fillStyle = 'rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.arc(p.x,p.y,1.6,0,Math.PI*2); ctx.fill(); }
    requestAnimationFrame(frame);
  }
  window.addEventListener('resize', ()=>{ init(); }); init(); frame();
})();

// MENU MODULE (unchanged, omitted comments for brevity)
(function menuModule(){
  const menuData = [
    {id:'ringkasan', title:'Ringkasan', subtitle:'Pengurus & jadwal piket', icon:'üè†'},
    {id:'jadwal', title:'Jadwal', subtitle:'Jadwal pelajaran', icon:'üìÖ'},
    {id:'pengumuman', title:'Pengumuman', subtitle:'Info terbaru', icon:'üì¢'},
    {id:'kegiatan', title:'Kegiatan', subtitle:'Agenda mendatang', icon:'üéØ'},
    {id:'pr', title:'Tugas', subtitle:'Tugas Rumah / PR', icon:'üìö'},
    {id:'developer', title:'Developer', subtitle:'Thanks To', icon:'ü•≥'},
    {id:'mathgame', title:'Game', subtitle:'Belajar sambil bermain!', icon:'üòè'}
  ];

  const menuPanel = $('#menuPanel');
  const menuList = $('#menuList');
  const equalsBtn = $('#equalsBtn');
  const searchInput = $('#menuSearch');
  const pages = $$('.page');

  function buildList(){ menuList.innerHTML = ''; menuData.forEach((m,i)=>{ const div=document.createElement('div'); div.className='menu-item ripple'; div.tabIndex=0; div.setAttribute('role','menuitem'); div.dataset.target=m.id; div.dataset.order=i; div.style.animationDelay=(60+i*60)+'ms'; div.innerHTML = `<div class="ic">${m.icon}</div><div style="flex:1"><div style="font-weight:800">${m.title}</div><div class="meta" style="color:var(--muted);font-size:13px">${m.subtitle}</div></div>`; menuList.appendChild(div); }); const first = menuList.querySelector('.menu-item'); if(first) first.classList.add('active'); }
  buildList();

  function openPanel(){ menuPanel.classList.add('open'); equalsBtn.setAttribute('aria-expanded','true'); menuPanel.setAttribute('aria-hidden','false'); setTimeout(()=>searchInput.focus(),180); }
  function closePanel(){ menuPanel.classList.remove('open'); equalsBtn.setAttribute('aria-expanded','false'); menuPanel.setAttribute('aria-hidden','true'); }
  function togglePanel(){ menuPanel.classList.contains('open') ? closePanel() : openPanel(); }

  equalsBtn.addEventListener('click', e=>{ e.stopPropagation(); togglePanel(); equalsBtn.animate([{transform:'scale(1)'},{transform:'scale(.96) rotate(-6deg)'},{transform:'scale(1)'}],{duration:220}); });
  document.addEventListener('click', e=>{ if(!menuPanel.contains(e.target) && e.target !== equalsBtn) closePanel(); });
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') closePanel(); if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); openPanel(); searchInput.focus(); } });
  searchInput.addEventListener('input', ()=>{ const q=(searchInput.value||'').trim().toLowerCase(); const items = Array.from(menuList.children); items.forEach(it=>{ const title = it.querySelector('div:nth-child(2) div').textContent.toLowerCase(); it.style.display = (q && !title.includes(q)) ? 'none' : 'flex'; }); });
  menuList.addEventListener('click', e=>{ const item = e.target.closest('.menu-item'); if(!item) return; const tgt = item.dataset.target; Array.from(menuList.children).forEach(c=>c.classList.remove('active')); item.classList.add('active'); showPage(tgt); closePanel(); });
  menuList.addEventListener('keydown', e=>{ const visible = Array.from(menuList.querySelectorAll('.menu-item')).filter(x=>x.style.display!=='none'); if(visible.length===0) return; const idx = visible.indexOf(document.activeElement); if(e.key==='ArrowDown'){ e.preventDefault(); visible[(idx+1)%visible.length].focus(); } if(e.key==='ArrowUp'){ e.preventDefault(); visible[(idx-1+visible.length)%visible.length].focus(); } if(e.key==='Enter' || e.key===' '){ e.preventDefault(); document.activeElement.click(); } });

  window.showPage = function(id){ const active = pages.find(p=>!p.classList.contains('hidden')) || pages[0]; const target = document.getElementById(id); if(!target || active===target) return; active.style.transition='opacity 300ms ease, transform 300ms cubic-bezier(.2,.9,.2,1)'; active.style.opacity='0'; active.style.transform='translateY(-8px) scale(.995)'; setTimeout(()=>{ active.classList.add('hidden'); active.style.opacity=''; active.style.transform=''; target.classList.remove('hidden'); target.style.opacity='0'; target.style.transform='translateY(12px) scale(.995)'; requestAnimationFrame(()=>{ target.style.transition='opacity 420ms ease, transform 420ms cubic-bezier(.2,.9,.2,1)'; target.style.opacity='1'; target.style.transform='translateY(0) scale(1)'; }); },320); };
  window.addEventListener('load', ()=>{ setTimeout(()=>{ showPage('ringkasan'); }, 100); });
})();

/* THEME MODULE */
(function themeModule(){
  const KEY='7c_theme_v6'; const btn=document.getElementById('themeToggle'); const root=document.documentElement;
  function applyTheme(theme){ if(theme==='light') root.setAttribute('data-theme','light'); else root.removeAttribute('data-theme'); btn.setAttribute('aria-pressed', theme==='light' ? 'true' : 'false'); try{ localStorage.setItem(KEY, theme); }catch(e){} }
  (function restore(){ try{ const saved = localStorage.getItem(KEY); if(saved){ applyTheme(saved); return; } }catch(e){} if(window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) applyTheme('light'); else applyTheme('dark'); })();
  btn.addEventListener('click', ()=>{ const current = root.getAttribute('data-theme') === 'light' ? 'light' : 'dark'; const next = current === 'light' ? 'dark' : 'light'; applyTheme(next); btn.animate([{transform:'scale(1)'},{transform:'scale(.96)'},{transform:'scale(1)'}],{duration:180}); });
})();

/* PARALLAX (unchanged) */
(function parallaxBlobs(){ const b1=document.querySelector('.blob.b1'); const b2=document.querySelector('.blob.b2'); const b3=document.querySelector('.blob.b3'); let lx=0,ly=0; function move(e){ const x=(e.clientX/window.innerWidth)-0.5; const y=(e.clientY/window.innerHeight)-0.5; lx += (x-lx)*0.08; ly += (y-ly)*0.08; if(b1) b1.style.transform = `translate(${lx*24}px, ${ly*18}px)`; if(b2) b2.style.transform = `translate(${lx*-18}px, ${ly*-12}px)`; if(b3) b3.style.transform = `translate(${lx*12}px, ${ly*-24}px)`; } window.addEventListener('mousemove', move); window.addEventListener('touchmove', (e)=>{ if(e.touches && e.touches[0]) move(e.touches[0]); }, {passive:true}); })();

/* RIPPLE */
(function ripple(){ function create(e){ const el=e.currentTarget; const rect=el.getBoundingClientRect(); const r=document.createElement('span'); const size=Math.max(rect.width,rect.height)*1.6; r.style.position='absolute'; r.style.width=r.style.height=size+'px'; r.style.left=(e.clientX-rect.left-size/2)+'px'; r.style.top=(e.clientY-rect.top-size/2)+'px'; r.style.borderRadius='50%'; r.style.background='rgba(255,255,255,0.06)'; r.style.transform='scale(0)'; r.style.opacity='1'; r.style.transition='transform 600ms ease, opacity 600ms ease'; r.style.pointerEvents='none'; el.appendChild(r); requestAnimationFrame(()=>{ r.style.transform='scale(1)'; r.style.opacity='0'; }); setTimeout(()=> r.remove(),700); }
  document.querySelectorAll('.ripple').forEach(el=>el.addEventListener('pointerdown', create)); })();

/* ADMIN BUTTON + MODAL LOGIC */
(function adminModule(){
  const adminBtn = document.getElementById('adminBtn');
  const backdrop = document.getElementById('adminBackdrop');
  const closeBtn = document.getElementById('closeAdmin');
  const frame = document.getElementById('adminFrame');
  const openNewTab = document.getElementById('openNewTab');
  const openRawBtn = document.getElementById('openRawBtn');

  // The path where tinyfilemanager should live on your webserver/termux
  const LOCAL_PATH = '/tinyfilemanager.php';
  // Raw GitHub URL for download (single-file manager). If you want latest version, go to repository.
  const GITHUB_RAW = 'https://raw.githubusercontent.com/prasathmani/tinyfilemanager/master/tinyfilemanager.php';

  function openModal(){ backdrop.style.display='flex'; backdrop.setAttribute('aria-hidden','false'); // try to load local path
    frame.src = LOCAL_PATH; }
  function closeModal(){ backdrop.style.display='none'; backdrop.setAttribute('aria-hidden','true'); frame.src = 'about:blank'; }

  adminBtn.addEventListener('click', ()=>{ openModal(); });
  closeBtn.addEventListener('click', ()=>{ closeModal(); });
  backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) closeModal(); });
  

  // Open file manager in new tab (same local path) ‚Äî user may host in Termux
  openNewTab.addEventListener('click', ()=>{ window.open(LOCAL_PATH,'_blank'); });

  // Open raw GitHub page to download the php file (fallback if file not on server)
  openRawBtn.addEventListener('click', ()=>{ window.open(GITHUB_RAW,'_blank'); });
})();

/* focus trap for menu */
(function focusTrap(){ const menu = document.getElementById('menuPanel'); document.addEventListener('keydown', (e)=>{ if(e.key !== 'Tab') return; if(!menu.classList.contains('open')) return; const focusable = Array.from(menu.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(a => a.offsetParent !== null); if(!focusable.length) return; const first = focusable[0], last = focusable[focusable.length - 1]; if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); } else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); } }); })();

window.goTo = function(id){ const list = document.getElementById('menuList'); if(!list) return; const item = Array.from(list.children).find(it => it.dataset.target === id); if(item) item.click(); };
  </script>
</body>
</html>

  <!-- (Full portal HTML continues here: for brevity in canvas the original portal body is included verbatim) -->

<?php
// --- Insert the rest of the portal HTML from user's provided template ---
// For the purpose of this single-file example, we'll echo the user's portal content directly below.
?>

<!-- NOTE: the original portal content continues here. For brevity in this editor the full portal HTML/CSS/JS is included as in the provided file. -->

<!-- In the original portal you provided, the <article id="mathgame"> was empty. We'll replace its inner content with the game UI. -->

<script>
// Inject game HTML into the article with id "mathgame" once DOM is ready
(function(){
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  document.addEventListener('DOMContentLoaded', function(){
    var art = document.getElementById('mathgame'); if(!art) return;
    art.innerHTML = `
      <h3>Belajar sambil bermain :)</h3>
      <div class="game-wrap">
        <div class="game-area">
          <div class="game-card">
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
              <div class="small">Skor: <strong id="g_score">0</strong></div>
              <div class="small">Streak: <strong id="g_streak">0</strong></div>
              <div class="small">Nyawa: <strong id="g_lives">3</strong></div>
            </div>
            <div class="question" id="g_question">Tekan "Mulai" untuk memulai permainan</div>
            <div class="small" id="g_hint">Pilih tingkat kesulitan lalu tekan mulai.</div>
            <div style="margin-top:8px" class="input-row">
              <input type="text" id="g_answer" placeholder="Jawaban (contoh: 3/4 atau 0.75)" />
              <button id="g_submit" class="btn">Kirim</button>
            </div>
            <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
              <div style="display:flex;gap:6px;align-items:center">Level:
                <button class="btn small g_diff" data-diff="1">Mudah</button>
                <button class="btn small g_diff" data-diff="2">Sedang</button>
                <button class="btn small g_diff" data-diff="3">Sulit</button>
              </div>
              <button id="g_start" class="btn">Mulai</button>
              <button id="g_skip" class="btn">Lewati (-1 nyawa)</button>
            </div>
            <div class="small" style="margin-top:8px">Tip: Pecahan = 3/4 atau desimal 0.75</div>
            <div style="margin-top:10px" id="g_log" class="small"></div>
          </div>

          <div class="game-card">
            <div style="font-weight:800">Papan Skor
            <button id="g_refresh" class="btn" title="Refresh papan skor">‚ü≥ Refresh</button>
            </div>
            <div id="g_highscores" style="margin-top:8px"></div>
          </div>
        </div>
      </div>
    `;

    // Add event listeners
    var difficulty = 1; var currentNonce = null; var playerName = 'Player';
    function api(action, data){
      if(action==='problem') return fetch('?action=problem&difficulty='+difficulty).then(r=>r.json());
      if(action==='submit') return fetch('?action=submit',{method:'POST',body:JSON.stringify(data)}).then(r=>r.json());
      if(action==='highscores') return fetch('?action=highscores').then(r=>r.json());
      if(action==='reset') return fetch('?action=reset').then(r=>r.json());
    }

    function log(msg){ var el=document.getElementById('g_log'); var d=document.createElement('div'); d.textContent='['+new Date().toLocaleTimeString()+'] '+msg; el.prepend(d); }

    function loadHighscores(showFlash){
  const refreshBtn = document.getElementById('g_refresh');
  const box = document.getElementById('g_highscores');
  if(!box) return Promise.resolve();

  // UI: disable tombol sementara
  if(refreshBtn){
    refreshBtn.disabled = true;
    refreshBtn.style.opacity = 0.6;
    refreshBtn.style.transform = 'scale(.98)';
  }

  // show tiny loader
  const old = box.innerHTML;
  box.innerHTML = '<div class="small">Memuat papan skor...</div>';

  return api('highscores').then(r => {
    if(!r.ok){
      box.innerHTML = '<div class="small">Gagal memuat papan skor</div>';
      return;
    }
    box.innerHTML = '';
    r.list.slice(0,10).forEach(function(it){
      var div = document.createElement('div');
      div.style.display = 'flex';
      div.style.justifyContent = 'space-between';
      div.style.padding = '6px 0';
      div.innerHTML = '<div style="font-weight:700">'+escapeHtml(it.name)+'</div><div>'+it.score+'</div>';
      box.appendChild(div);
    });

    // small flash animation on success
    if(showFlash && box.firstChild){
      box.firstChild.animate([{ opacity: 0.6 }, { opacity: 1 }], { duration: 420, easing: 'ease-out' });
    }
  }).catch(err=>{
    box.innerHTML = '<div class="small">Error: ' + (err && err.message ? escapeHtml(err.message) : 'network') + '</div>';
  }).finally(()=>{
    if(refreshBtn){
      refreshBtn.disabled = false;
      refreshBtn.style.opacity = '';
      refreshBtn.style.transform = '';
      // subtle pulse when enabled
      refreshBtn.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.04)' }, { transform: 'scale(1)' }], { duration: 360, easing: 'ease-out' });
    }
  });
}


    function startGame(){ api('reset').then(()=>{ document.getElementById('g_score').textContent='0'; document.getElementById('g_streak').textContent='0'; document.getElementById('g_lives').textContent='3'; document.getElementById('g_log').innerHTML=''; loadHighscores(); nextProblem(); }); }

    function nextProblem(){ api('problem').then(r=>{ if(!r.ok){ alert('Gagal mendapatkan soal'); return; } currentNonce = r.nonce; document.getElementById('g_question').innerHTML = r.question_html; document.getElementById('g_hint').textContent = r.hint; document.getElementById('g_answer').value = ''; if(r.time_limit) startTimer(r.time_limit); }); }

    var timeLeft=0, timer=null;
    function startTimer(s){ stopTimer(); timeLeft=s; timer = setInterval(()=>{ timeLeft--; if(timeLeft<=0){ stopTimer(); onTimeUp(); } },1000); }
    function stopTimer(){ if(timer) clearInterval(timer); timer=null; }
    function onTimeUp(){ log('Waktu habis!'); api('submit',{nonce:currentNonce,answer:''}).then(handleSubmit); }

    function submitAnswer(){ var v=document.getElementById('g_answer').value.trim(); if(!currentNonce){ alert('Tekan Mulai dulu'); return; } api('submit',{nonce:currentNonce,answer:v,player:playerName}).then(handleSubmit); }
function handleSubmit(r){
  if(!r.ok){ alert(r.error||'Error'); return; }
  log(r.message);
  document.getElementById('g_score').textContent = r.score;
  document.getElementById('g_streak').textContent = r.streak;
  document.getElementById('g_lives').textContent = r.lives;
  stopTimer();

  if(r.game_over){
    // Jika server meminta nama, tampilkan prompt (atau ambil dari input #g_player jika ada)
    if(r.requires_name){
      // prefer input field if ada
      var nameEl = document.getElementById('g_player');
      var name = (nameEl && nameEl.value && nameEl.value.trim()) ? nameEl.value.trim() : null;
      if(!name){
        name = prompt('Permainan selesai! Masukkan nama untuk papan skor:', '');
        if(!name || !name.trim()) name = 'Player';
      }
      // kirim ke server agar disimpan
      fetch('?action=save_name', {
        method: 'POST',
        body: JSON.stringify({ name: name })
      }).then(res => res.json()).then(rr => {
        if(rr.ok){
          playerName = name;
          loadHighscores();
          alert('Skor tersimpan sebagai ' + name);
        } else {
          alert('Gagal menyimpan nama: ' + (rr.error || 'error'));
          // fallback: muat highscores (mungkin kosong)
          loadHighscores();
        }
      }).catch(err => {
        alert('Network error saat menyimpan nama.');
        loadHighscores();
      });
    } else {
      // tidak butuh nama (fallback)
      loadHighscores();
      alert('Game over! Skor: ' + r.score);
    }
    return;
  }

  setTimeout(nextProblem, 700);
}
    // tombol refresh papan skor
    document.addEventListener('click', function(e){
  if(e.target && e.target.id === 'g_refresh'){
    loadHighscores(true);
  }
});
    document.getElementById('g_submit').addEventListener('click', submitAnswer);
    document.getElementById('g_start').addEventListener('click', startGame);
    document.getElementById('g_skip').addEventListener('click', function(){ if(!confirm('Lewati soal ini? -1 nyawa')) return; api('submit',{nonce:currentNonce,answer:'__skip__',player:playerName}).then(handleSubmit); });
    document.getElementById('g_answer').addEventListener('keydown', function(e){ if(e.key==='Enter') submitAnswer(); });
    Array.from(document.querySelectorAll('.g_diff')).forEach(function(btn){ btn.addEventListener('click', function(){ difficulty = parseInt(btn.dataset.diff||'1'); Array.from(document.querySelectorAll('.g_diff')).forEach(x=>x.style.opacity=0.6); btn.style.opacity=1; }); });

    // initial
    loadHighscores();
  });
})();
// === Fancy logo rain (improved) ===
(function(){
  const LOGO_URL = 'https://files.cloudkuimages.guru/images/9Owut0x4.jpg';
  let container = null;
  let intervalId = null;
  let stopTimerId = null;
  let isRaining = false;

  // tweakable params
  const DEFAULT = {
    duration: 5000,      // total duration of a rain burst (ms)
    interval: 110,       // interval between mini-bursts (ms)
    burstCount: 1,       // number of drops per interval
    sizeMin: 20,         // px
    sizeMax: 60,         // px
    tiltMax: 18,         // deg rotation
    driftX: 140,         // max horizontal drift px (left/right)
    zDepthScale: [0.78, 1.14] // multiply size for depth illusion
  };

  const shapes = ['shape-circle','shape-round','shape-hex','shape-round']; // variety

  function ensureContainer(){
    if(container) return container;
    container = document.createElement('div');
    container.className = 'rain-container';
    document.body.appendChild(container);
    return container;
  }

  function rand(min, max){ return min + Math.random() * (max - min); }
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  function createDrop(opts = {}){
    const cfg = Object.assign({}, DEFAULT, opts);
    const cont = ensureContainer();
    const el = document.createElement('div');
    el.className = 'logo-drop ' + pick(shapes);
    const sizeBase = rand(cfg.sizeMin, cfg.sizeMax);
    // depth variation (some appear further/nearer)
    const depth = rand(cfg.zDepthScale[0], cfg.zDepthScale[1]);
    const w = Math.round(sizeBase * depth);
    el.style.width = w + 'px';
    el.style.height = w + 'px';

    // horizontal start position
    const startX = Math.random() * (window.innerWidth - w);
    el.style.left = Math.max(8, Math.round(startX)) + 'px';
    // badge content
    const badge = document.createElement('div');
    badge.className = 'badge';
    // inner img
    const img = document.createElement('img');
    img.src = LOGO_URL;
    img.alt = '7 Cah Juara';
    badge.appendChild(img);
    el.appendChild(badge);
    cont.appendChild(el);

    // compute animation curve: S-like fall with drift, rotate, scale
    const fromY = -160 - Math.random()*80;
    const toY = window.innerHeight + 160 + Math.random()*120;
    const drift = (Math.random() - 0.5) * cfg.driftX;
    const rotate = (Math.random()*cfg.tiltMax*2) - cfg.tiltMax;
    const rotate2 = rotate + (Math.random()*180 - 90);
    const scaleStart = rand(0.92, 1.06) * (1 - (depth-1)*0.08);
    const scaleEnd = rand(0.86, 1.12) * (1 + (depth-1)*0.06);
    const totalDur = Math.round(rand(cfg.duration * 0.6, cfg.duration * 1.25));

    // keyframes approximate a smooth S path using offset points
    const keyframes = [
      { transform: `translate(${0}px, ${fromY}px) rotate(${rotate}deg) scale(${scaleStart})`, opacity:1, offset:0 },
      { transform: `translate(${drift*0.3}px, ${fromY + (toY-fromY)*0.35}px) rotate(${rotate + (rotate2-rotate)*0.35}deg) scale(${(scaleStart+scaleEnd)/2})`, opacity:1, offset:0.35 },
      { transform: `translate(${drift*0.6}px, ${fromY + (toY-fromY)*0.70}px) rotate(${rotate + (rotate2-rotate)*0.7}deg) scale(${(scaleStart+scaleEnd)/1.1})`, opacity:1, offset:0.7 },
      { transform: `translate(${drift}px, ${toY}px) rotate(${rotate2}deg) scale(${scaleEnd})`, opacity:0.02, offset:1 }
    ];

    const anim = el.animate(keyframes, {
      duration: totalDur,
      easing: 'cubic-bezier(.16,.9,.32,1)',
      iterations: 1,
      fill: 'forwards'
    });

    // subtle parallax filter change during fall
    img.animate([
      { transform: 'rotate(0deg) scale(1)' },
      { transform: `rotate(${(Math.random()*40-20)}deg) scale(${1 - Math.random()*0.06})` }
    ], { duration: totalDur*0.9, easing:'ease-in-out', fill:'forwards' });

    // cleanup: fade out dulu lalu hapus
    anim.onfinish = () => {
      try {
        // tambahkan class fading untuk transisi CSS
        el.classList.add('fading');
        // setelah transisi selesai, hapus element dari DOM
        // waktu 900ms agar melebihi durasi transition di CSS (720ms)
        setTimeout(()=>{ if(el.parentNode) el.remove(); }, 940);
      } catch (e) { try{ el.remove(); }catch(e){} }
    };
    // fallback remove jika sesuatu gagal (safety)
    setTimeout(()=>{ if(el.parentNode){
      // jika belum pernah diberi class fading, beri dan schedule remove
      if(!el.classList.contains('fading')) el.classList.add('fading');
      setTimeout(()=>{ if(el.parentNode) el.remove(); }, 940);
    } }, totalDur + 1200);

    return el;
  }

  function startRain(opts = {}){
    const cfg = Object.assign({}, DEFAULT, opts);
    // extend existing rain if running
    if(isRaining){
      clearTimeout(stopTimerId);
      stopTimerId = setTimeout(stopRain, cfg.duration);
      return;
    }
    isRaining = true;
    ensureContainer();
    intervalId = setInterval(()=> {
      // burst small randomized number each tick
      const burst = Math.max(1, Math.round(cfg.burstCount * (0.6 + Math.random()*0.9)));
      for(let i=0;i<burst;i++){
        // slight horizontal jitter for each within burst
        setTimeout(()=> createDrop(cfg), Math.round(Math.random()*Math.min(220, cfg.interval)));
      }
    }, cfg.interval);

    stopTimerId = setTimeout(stopRain, cfg.duration);
  }

  function stopRain(){
    if(intervalId){ clearInterval(intervalId); intervalId = null; }
    if(stopTimerId){ clearTimeout(stopTimerId); stopTimerId = null; }
    isRaining = false;
    // keep container a little so last items finish then remove
    setTimeout(()=>{ if(container && container.parentNode) container.remove(); container = null; }, 5000);
  }

  // Toggle behavior: clicking logo-square triggers a nicer burst
  document.addEventListener('click', function(e){
    const logo = e.target.closest('.logo-square, .logo-square img');
    if(!logo) return;
    // an expressive burst tuned for click
    startRain({ duration: 5200, interval: 95, burstCount: 4, sizeMin: 44, sizeMax: 86, driftX: 220 });
    // micro feedback on logo
    const el = logo.classList && logo.classList.contains('logo-square') ? logo : (logo.closest('.logo-square') || logo);
    if(el){
      el.animate([
        { transform: 'translateY(0px) scale(1)' },
        { transform: 'translateY(-8px) scale(.98) rotate(-6deg)' },
        { transform: 'translateY(0px) scale(1)' }
      ], { duration: 420, easing: 'ease-out' });
    }
  });

  // Expose API
  window.startLogoRain = startRain;
  window.stopLogoRain = stopRain;
})();
// Member tabs interactivity
(function(){
  const container = document.getElementById('memberTabs');
  if(!container) return;
  const buttons = Array.from(container.querySelectorAll('.tab-btn'));
  const panels = Array.from(container.querySelectorAll('.member-panel'));

  function activate(memberKey){
    buttons.forEach(b => {
      const is = b.dataset.member === memberKey;
      b.classList.toggle('active', is);
      b.setAttribute('aria-selected', is ? 'true' : 'false');
    });
    panels.forEach(p => {
      const is = p.dataset.member === memberKey;
      if(is){
        p.classList.add('active');
        p.removeAttribute('hidden');
      } else {
        p.classList.remove('active');
        p.setAttribute('hidden','');
      }
    });
  }

  buttons.forEach(btn => {
    btn.addEventListener('click', ()=> activate(btn.dataset.member));
    btn.addEventListener('keydown', (e)=>{
      const idx = buttons.indexOf(btn);
      if(e.key === 'ArrowDown' || e.key === 'ArrowRight'){ e.preventDefault(); buttons[(idx+1)%buttons.length].focus(); }
      if(e.key === 'ArrowUp' || e.key === 'ArrowLeft'){ e.preventDefault(); buttons[(idx-1+buttons.length)%buttons.length].focus(); }
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
    });
  });

  // initial
  const activeBtn = container.querySelector('.tab-btn.active') || buttons[0];
  if(activeBtn) activate(activeBtn.dataset.member);
})();
// Auto-fix tab images: jika tombol gagal load, gunakan gambar panel atau placeholder
(function(){
  const btnImgs = Array.from(document.querySelectorAll('.tab-btn img'));
  btnImgs.forEach(img=>{
    // lebih andal: pasang event listener onerror lewat JS (jangan hanya atribut onerror)
    img.addEventListener('error', function onImgErr(){
      // ambil member key dari tombol
      const btn = img.closest('.tab-btn');
      if(!btn) return;
      const member = btn.dataset.member;
      // coba cari gambar di panel detail (kamu sudah mengisi panel dengan link full https)
      const panelImg = document.querySelector('.member-panel[data-member="'+member+'"] img');
      if(panelImg && panelImg.src && !panelImg.src.includes('placeholder.com')){
        // gunakan src dari panel (biasanya full URL yang valid)
        img.removeEventListener('error', onImgErr);
        img.src = panelImg.src;
        return;
      }
      // fallback: gunakan placeholder dengan nama
      const ph = 'https://via.placeholder.com/72?text=' + encodeURIComponent(member);
      if(img.src !== ph){
        img.removeEventListener('error', onImgErr);
        img.src = ph;
      } else {
        // jika placeholder juga gagal, sembunyikan gambar agar user nggak lihat ikon broken
        img.style.visibility = 'hidden';
      }
    });

    // Optional: jika gambar sudah kosong atau relatif yang salah, trigger check
    if(!img.complete || img.naturalWidth === 0){
      // coba set ulang src agar event error terpanggil bila invalid
      const cur = img.getAttribute('src') || '';
      img.src = cur; // retrigger load
    }
  });

  // Debug helper: log semua gambar yang 404/403 ke console via fetch HEAD
  // (non-blocking, hanya untuk dev)
  if(window.location.hostname === 'localhost' || window.location.hostname.includes('127.') ){
    btnImgs.forEach(img=>{
      const u = img.getAttribute('src');
      if(!u) return;
      fetch(u, { method: 'HEAD' }).then(res=>{
        if(!res.ok) console.warn('GAMBAR CHECK:', u, 'status', res.status);
      }).catch(err=>{
        console.warn('GAMBAR FETCH ERR:', u, err);
      });
    });
  }
})();

</script>

</body>
</html>
